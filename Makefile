# make  to compile without debug info
# make DEBUG=1 to compile with debug info
all: H.BIN HBL.prx

CC = psp-gcc

# use a different FOLDER to make for different exploits
# Exploit-specific files go in the subfolders, see targets hbl and loader below

ifdef DEBUG
FLAGS = DEBUG=$(DEBUG)
elif defined(NID_DEBUG)
FLAGS = NID_DEBUG=$(NID_DEBUG)
endif

H.BIN: config.h libpspuser/libpspuser.a
	make -f Makefile_h $(FLAGS)

HBL.prx: config.h libpspuser/libpspuser.a
	make -f Makefile_hbl $(FLAGS)

libpspuser/libpspuser.a:
	make -C libpspuser -f Makefile

config.h: config.txt
	-@echo "//config.h is automatically generated by the Makefile!!!" > $@
	-@echo "#ifndef SVNVERSION" >> $@
	-@echo "#define SVNVERSION \"$(shell svnversion -n)\"" >> $@
	-SubWCRev . $< $@
	-@echo "#include <exploits/$(EXPLOIT).h>" >> $@
	-@echo "#endif" >> $@

clean:
	rm -f config.h
	make -C libpspuser -f Makefile clean
	make -f Makefile_h clean
	make -f Makefile_hbl clean
